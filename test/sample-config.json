{
  "path": "/tokiEndpoint",
  "tags": [],
  "description": "Do some things, then emit to RabbitMQ",
  "actions": [
    {
      "name": "action1",
      "type": "toki-method-http",
      "createConfiguration": {},
      "assembleConfiguration": [
        {
          "writeToKey": "doc1",
          "webhookUri": "uri/path/{{=it.doc1.id}}",
          "idKey": "conversationId",
          "httpAction": "GET"
        },
        {
          "writeToKey" : "doc2",
          "webhookUri" : "uri/path/message",
          "idKey" : "messageId",
          "httpAction" : "POST",
          "requestBody" : "{ \"ids\" : [\"{{=it.doc2.id}}\"] }"
        }
      ]
    },
    {
      "name": "Rabbit",
      "type": "toki-method-rabbit",
      "rabbitConfiguration": {
        "server": "rabbitbox",
        "user": "guest",
        "password": "guest",
        "vhost": "guest"
      },
      "createConfiguration": {
        "event": "toki.request-processed",
        "message": {
          "uri": "{{=it.action1.output.doc1.webhookUri}}",
          "httpAction": "POST",
          "payload": {
            "id": "{{=it.action1.output.doc1.id}}"
          }
        },
        "conversation": {
          "uri": "{{=it.action1.output.doc2.webhookUri}}",
          "httpAction": "POST",
          "payload": {
            "id": "{{=it.action1.output.doc2.requestBody}}"
          }
        }
      }
    }
  ]
}